/* USER CODE BEGIN Header */
/**
  ******************************************************************************
  * @file           : main.c
  * @brief          : Main program body
  ******************************************************************************
  * @attention
  *
  * Copyright (c) 2023 STMicroelectronics.
  * All rights reserved.
  *
  * This software is licensed under terms that can be found in the LICENSE file
  * in the root directory of this software component.
  * If no LICENSE file comes with this software, it is provided AS-IS.
  *
  ******************************************************************************
  */
/* USER CODE END Header */
/* Includes ------------------------------------------------------------------*/
#include "main.h"
#include "i2c.h"
#include "gpio.h"

/* Private includes ----------------------------------------------------------*/
/* USER CODE BEGIN Includes */

/* USER CODE END Includes */

/* Private typedef -----------------------------------------------------------*/
/* USER CODE BEGIN PTD */

/* USER CODE END PTD */

/* Private define ------------------------------------------------------------*/
/* USER CODE BEGIN PD */

/* USER CODE END PD */

/* Private macro -------------------------------------------------------------*/
/* USER CODE BEGIN PM */

/* USER CODE END PM */

/* Private variables ---------------------------------------------------------*/

/* USER CODE BEGIN PV */

/* USER CODE END PV */

/* Private function prototypes -----------------------------------------------*/
void SystemClock_Config(void);
/* USER CODE BEGIN PFP */

/* USER CODE END PFP */

/* Private user code ---------------------------------------------------------*/
/* USER CODE BEGIN 0 */
#define ADD1 0x46
#define ADD2 0x42
#define ADD3 0x48
#define ADD_DAC 0XC0
/* USER CODE END 0 */
const uint8_t Display_7Seg_C[] = {0x3F, 0X06 ,0X5B ,0x4f,0X66 ,0X6D, 0X7D, 0X07 ,0X7F, 0X67};
const uint16_t dato_sine[481] ={2101,2295,2052,2246,2440,2197,2390,2584,2340,2533,2725,2481,2672,2864,2618,2809,2999,2752,2941,3129,2880,3067,3254,3003,3188,3372,3119,3302,3484,3228,3409,3588,3330,3507,3684,3422,3597,3770,3506,3678,3848,3580,3749,3916,3645,3809,3973,3698,3860,4019,3741,3899,4055,3774,3927,4080,3794,3944,4093,3804,3950,4095,3802,3944,4086,3789,3927,4065,3764,3899,4033,3728,3860,3990,3682,3809,3936,3624,3749,3872,3557,3678,3797,3479,3597,3714,3392,3507,3621,3297,3409,3519,3193,3302,3410,3081,3188,3294,2963,3067,3171,2838,2941,3043,2708,2809,2909,2573,2672,2772,2434,2533,2631,2292,2390,2488,2149,2246,2343,2004,2101,2198,1859,1956,2053,1714,1812,1910,1571,1669,1768,1430,1530,1629,1293,1394,1495,1160,1262,1364,1031,1135,1240,908,1014,1121,792,900,1009,683,794,905,581,695,810,489,605,723,405,525,645,331,454,578,266,393,521,213,343,474,170,303,438,138,275,414,117,258,400,107,252,398,109,258,408,122,275,429,147,303,461,183,343,504,229,393,558,287,454,622,354,525,696,432,605,780,519,695,873,614,794,974,718,900,1083,830,1014,1199,949,1135,1322,1073,1262,1451,1203,1394,1584,1338,1530,1722,1477,1669,1862,1619,1812,2005,1762,1956,2150,1907,2101,2295,2052,2246,2440,2197,2390,2584,2340,2533,2725,2481,2672,2864,2618,2809,2999,2752,2941,3129,2880,3067,3254,3003,3188,3372,3119,3302,3484,3228,3409,3588,3330,3507,3684,3422,3597,3770,3506,3678,3848,3580,3749,3916,3645,3809,3973,3698,3860,4019,3741,3899,4055,3774,3927,4080,3794,3944,4093,3804,3950,4095,3802,3944,4086,3789,3927,4065,3764,3899,4033,3728,3860,3990,3682,3809,3936,3624,3749,3872,3557,3678,3797,3479,3597,3714,3392,3507,3621,3297,3409,3519,3193,3302,3410,3081,3188,3294,2963,3067,3171,2838,2941,3043,2708,2809,2909,2573,2672,2772,2434,2533,2631,2292,2390,2488,2149,2246,2343,2004,2101,2198,1859,1956,2053,1714,1812,1910,1571,1669,1768,1430,1530,1629,1293,1394,1495,1160,1262,1364,1031,1135,1240,908,1014,1121,792,900,1009,683,794,905,581,695,810,489,605,723,405,525,645,331,454,578,266,393,521,213,343,474,170,303,438,138,275,414,117,258,400,107,252,398,109,258,408,122,275,429,147,303,461,183,343,504,229,393,558,287,454,622,354,525,696,432,605,780,519,695,873,614,794,974,718,900,1083,830,1014,1199,949,1135,1322,1073,1262,1451,1203,1394,1584,1338,1530,1722,1477,1669,1862,1619,1812,2005,1762,1956,2150,1907,2101};
  //const uint16_t dato_sawboth[481] = {3964,4095,3787,3918,4049,3741,3872,4002,3695,3825,3956,3648,3779,3909,3602,3732,3863,3555,3686,3817,3509,3640,3770,3463,3593,3724,3416,3547,3677,3370,3500,3631,3323,3454,3585,3277,3408,3538,3231,3361,3492,3184,3315,3446,3138,3268,3399,3091,3222,3353,3045,3176,3306,2999,3129,3260,2952,3083,3214,2906,3037,3167,2860,2990,3121,2813,2944,3074,2767,2897,3028,2720,2851,2982,2674,2805,2935,2628,2758,2889,2581,2712,2842,2535,2665,2796,2488,2619,2750,2442,2573,2703,2396,2526,2657,2349,2480,2610,2303,2433,2564,2256,2387,2518,2210,2341,2471,2164,2294,2425,2117,2248,2379,2071,2201,2332,2024,2155,2286,1978,2109,2239,1932,2062,2193,1885,2016,2147,1839,1970,2100,1793,1923,2054,1746,1877,2007,1700,1830,1961,1653,1784,1915,1607,1738,1868,1561,1691,1822,1514,1645,1775,1468,1598,1729,1421,1552,1683,1375,1506,1636,1329,1459,1590,1282,1413,1543,1236,1366,1497,1189,1320,1451,1143,1274,1404,1097,1227,1358,1050,1181,1312,1004,1134,1265,957,1088,1219,911,1042,1172,865,995,1126,818,949,1080,772,903,1033,726,856,987,679,810,940,633,763,894,586,717,848,540,671,801,494,624,755,447,578,708,401,531,662,354,485,616,308,439,569,262,392,523,215,346,476,169,299,430,122,3964,4095,3787,3918,4049,3741,3872,4002,3695,3825,3956,3648,3779,3909,3602,3732,3863,3555,3686,3817,3509,3640,3770,3463,3593,3724,3416,3547,3677,3370,3500,3631,3323,3454,3585,3277,3408,3538,3231,3361,3492,3184,3315,3446,3138,3268,3399,3091,3222,3353,3045,3176,3306,2999,3129,3260,2952,3083,3214,2906,3037,3167,2860,2990,3121,2813,2944,3074,2767,2897,3028,2720,2851,2982,2674,2805,2935,2628,2758,2889,2581,2712,2842,2535,2665,2796,2488,2619,2750,2442,2573,2703,2396,2526,2657,2349,2480,2610,2303,2433,2564,2256,2387,2518,2210,2341,2471,2164,2294,2425,2117,2248,2379,2071,2201,2332,2024,2155,2286,1978,2109,2239,1932,2062,2193,1885,2016,2147,1839,1970,2100,1793,1923,2054,1746,1877,2007,1700,1830,1961,1653,1784,1915,1607,1738,1868,1561,1691,1822,1514,1645,1775,1468,1598,1729,1421,1552,1683,1375,1506,1636,1329,1459,1590,1282,1413,1543,1236,1366,1497,1189,1320,1451,1143,1274,1404,1097,1227,1358,1050,1181,1312,1004,1134,1265,957,1088,1219,911,1042,1172,865,995,1126,818,949,1080,772,903,1033,726,856,987,679,810,940,633,763,894,586,717,848,540,671,801,494,624,755,447,578,708,401,531,662,354,485,616,308,439,569,262,392,523,215,346,476,169,299,430,122,3964};
//const uint16_t dato_square[481] = {252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,252,398,107,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,3949,4095,3804,252};

/**
  * @brief  The application entry point.
  * @retval int
  */
int main(void)
{
  /* USER CODE BEGIN 1 */

  /* USER CODE END 1 */

  /* MCU Configuration--------------------------------------------------------*/

  /* Reset of all peripherals, Initializes the Flash interface and the Systick. */
  HAL_Init();

  /* USER CODE BEGIN Init */

  /* USER CODE END Init */

  /* Configure the system clock */
  SystemClock_Config();

  /* USER CODE BEGIN SysInit */

  /* USER CODE END SysInit */

  /* Initialize all configured peripherals */
  MX_GPIO_Init();
  MX_I2C1_Init();
  /* USER CODE BEGIN 2 */
  uint8_t i= 0,j= 0,k = 0;
//HAL_I2C_Master_Transmit(&hi2c1, ADD, &dato, 1, 100);
  /* USER CODE END 2 */
uint8_t dato_send[2];
  /* Infinite loop */
  /* USER CODE BEGIN WHILE */
  while (1)
  {
	 /* for (i = 0; i < 10; ++i) {
		//  uint8_t tmp = 1<<dato;
		  HAL_I2C_Master_Transmit(&hi2c1, ADD1, &Display_7Seg_C[i], 1, 100);
		  for (j = 0; j < 10; ++j) {
			  HAL_I2C_Master_Transmit(&hi2c1, ADD2, &Display_7Seg_C[j], 1, 100);
			for (k = 0; k < 10; ++k) {
				HAL_I2C_Master_Transmit(&hi2c1, ADD3, &Display_7Seg_C[k], 1, 100);
				HAL_Delay(200);
			}
		}

	}*/
	  uint16_t var;
	  for (var = 0; var < 481; ++var) {
		  	  dato_send[0] = dato_sine[var] >> 8;
		 	  dato_send[1] = dato_sine[var] & 0xFF;
		 	  HAL_I2C_Master_Transmit(&hi2c1, ADD_DAC, &dato_send, 2, 100);
		 	  HAL_Delay(20);
	}



    /* USER CODE END WHILE */

    /* USER CODE BEGIN 3 */
  }
  /* USER CODE END 3 */
}

/**
  * @brief System Clock Configuration
  * @retval None
  */
void SystemClock_Config(void)
{
  RCC_OscInitTypeDef RCC_OscInitStruct = {0};
  RCC_ClkInitTypeDef RCC_ClkInitStruct = {0};

  /** Configure the main internal regulator output voltage
  */
  __HAL_RCC_PWR_CLK_ENABLE();
  __HAL_PWR_VOLTAGESCALING_CONFIG(PWR_REGULATOR_VOLTAGE_SCALE2);

  /** Initializes the RCC Oscillators according to the specified parameters
  * in the RCC_OscInitTypeDef structure.
  */
  RCC_OscInitStruct.OscillatorType = RCC_OSCILLATORTYPE_HSI;
  RCC_OscInitStruct.HSIState = RCC_HSI_ON;
  RCC_OscInitStruct.HSICalibrationValue = RCC_HSICALIBRATION_DEFAULT;
  RCC_OscInitStruct.PLL.PLLState = RCC_PLL_NONE;
  if (HAL_RCC_OscConfig(&RCC_OscInitStruct) != HAL_OK)
  {
    Error_Handler();
  }

  /** Initializes the CPU, AHB and APB buses clocks
  */
  RCC_ClkInitStruct.ClockType = RCC_CLOCKTYPE_HCLK|RCC_CLOCKTYPE_SYSCLK
                              |RCC_CLOCKTYPE_PCLK1|RCC_CLOCKTYPE_PCLK2;
  RCC_ClkInitStruct.SYSCLKSource = RCC_SYSCLKSOURCE_HSI;
  RCC_ClkInitStruct.AHBCLKDivider = RCC_SYSCLK_DIV1;
  RCC_ClkInitStruct.APB1CLKDivider = RCC_HCLK_DIV1;
  RCC_ClkInitStruct.APB2CLKDivider = RCC_HCLK_DIV1;

  if (HAL_RCC_ClockConfig(&RCC_ClkInitStruct, FLASH_LATENCY_0) != HAL_OK)
  {
    Error_Handler();
  }
}

/* USER CODE BEGIN 4 */

/* USER CODE END 4 */

/**
  * @brief  This function is executed in case of error occurrence.
  * @retval None
  */
void Error_Handler(void)
{
  /* USER CODE BEGIN Error_Handler_Debug */
  /* User can add his own implementation to report the HAL error return state */
  __disable_irq();
  while (1)
  {
  }
  /* USER CODE END Error_Handler_Debug */
}

#ifdef  USE_FULL_ASSERT
/**
  * @brief  Reports the name of the source file and the source line number
  *         where the assert_param error has occurred.
  * @param  file: pointer to the source file name
  * @param  line: assert_param error line source number
  * @retval None
  */
void assert_failed(uint8_t *file, uint32_t line)
{
  /* USER CODE BEGIN 6 */
  /* User can add his own implementation to report the file name and line number,
     ex: printf("Wrong parameters value: file %s on line %d\r\n", file, line) */
  /* USER CODE END 6 */
}
#endif /* USE_FULL_ASSERT */
